import "pkg:/source/enums/ColorPalette.bs"
import "pkg:/source/enums/KeyCode.bs"
import "pkg:/source/utils/misc.bs"

sub init()
    m.alphaGrid = m.top.findNode("alphaGrid")
    m.alphaContent = m.top.findNode("alphaContent")

    m.alphaGrid.focusBitmapBlendColor = chainLookupReturn(m.global.session, "user.settings.colorCursor", ColorPalette.HIGHLIGHT)
    m.alphaGrid.focusFootprintBlendColor = ColorPalette.TRANSPARENT

    m.alphaGrid.observeField("itemSelected", "onItemSelected")
end sub

sub onItemSelected()
    child = m.alphaContent.getChild(m.alphaGrid.itemSelected)
    if isValid(child)
        m.top.letterSelected = child.title
    end if
end sub

function onKeyEvent(key as string, press as boolean) as boolean
    if not press then return false
    if not m.alphaGrid.isInFocusChain() then return false

    ' Let UP/DOWN escape to parent for grid/toolbar navigation
    if key = KeyCode.UP or key = KeyCode.DOWN
        return false
    end if

    ' LEFT at first item should escape to toolbar icons
    if key = KeyCode.LEFT and m.alphaGrid.itemFocused = 0
        return false
    end if

    return false
end function
